import type { Problem } from '@/types/problem';

export const problem: Problem = {
  id: 'advanced-014', level: 'advanced', order: 14,
  title: { ko: 'ALTER TABLE 심화: 컬럼 변경/삭제/이름변경', en: 'ALTER TABLE Advanced: Modify, Drop, Rename Columns' },
  description: {
    ko: `\`products\` 테이블 구조를 여러 방식으로 변경하세요.\n\n### 요구사항\n아래 ALTER TABLE 문들을 순서대로 실행하세요:\n\n**1. 컬럼 추가**: 할인율 컬럼\n\`\`\`sql\nALTER TABLE products\nADD COLUMN IF NOT EXISTS discount_rate DECIMAL(5,2) DEFAULT 0.00;\n\`\`\`\n\n**2. 컬럼 이름 변경**: stock_quantity → inventory_count\n\`\`\`sql\nALTER TABLE products\nRENAME COLUMN stock_quantity TO inventory_count;\n\`\`\`\n\n**3. 결과 확인**:\n\`\`\`sql\nSELECT column_name, data_type, column_default\nFROM information_schema.columns\nWHERE table_name = 'products'\n  AND column_name IN ('discount_rate', 'inventory_count')\nORDER BY column_name;\n\`\`\`\n\n> **채점**: 3번 SELECT 쿼리의 결과로 채점됩니다.\n\n> ⚠️ **주의**: RENAME COLUMN 실행 후에는 stock_quantity 대신 inventory_count를 사용해야 합니다.`,
    en: `Modify the \`products\` table structure in multiple ways.\n\n### Requirements\nRun the following ALTER TABLE statements in order:\n\n**1. Add column**: discount rate\n\`\`\`sql\nALTER TABLE products\nADD COLUMN IF NOT EXISTS discount_rate DECIMAL(5,2) DEFAULT 0.00;\n\`\`\`\n\n**2. Rename column**: stock_quantity → inventory_count\n\`\`\`sql\nALTER TABLE products\nRENAME COLUMN stock_quantity TO inventory_count;\n\`\`\`\n\n**3. Verify changes**:\n\`\`\`sql\nSELECT column_name, data_type, column_default\nFROM information_schema.columns\nWHERE table_name = 'products'\n  AND column_name IN ('discount_rate', 'inventory_count')\nORDER BY column_name;\n\`\`\`\n\n> **Grading**: Based on step 3's SELECT query result.\n\n> ⚠️ **Note**: After RENAME COLUMN, use inventory_count instead of stock_quantity.`,
  },
  schema: 'ecommerce', category: 'DDL', difficulty: 2,
  hints: {
    ko: ['ALTER TABLE ... ADD COLUMN IF NOT EXISTS로 안전하게 컬럼을 추가합니다.', 'RENAME COLUMN은 기존 데이터를 유지한 채 이름만 변경합니다.', "SELECT column_name, data_type, column_default FROM information_schema.columns WHERE table_name = 'products' AND column_name IN ('discount_rate', 'inventory_count') ORDER BY column_name;"],
    en: ['Use ALTER TABLE ... ADD COLUMN IF NOT EXISTS for safe column addition.', 'RENAME COLUMN changes name while preserving data.', "SELECT column_name, data_type, column_default FROM information_schema.columns WHERE table_name = 'products' AND column_name IN ('discount_rate', 'inventory_count') ORDER BY column_name;"],
  },
  explanation: {
    ko: `## ALTER TABLE 심화\n\n### 1. 컬럼 추가\n\`\`\`sql\nALTER TABLE products\nADD COLUMN IF NOT EXISTS discount_rate DECIMAL(5,2) DEFAULT 0.00;\n\`\`\`\n\n### 2. 컬럼 이름 변경\n\`\`\`sql\nALTER TABLE products\nRENAME COLUMN stock_quantity TO inventory_count;\n\`\`\`\n\n### 주요 ALTER TABLE 작업\n| 작업 | PostgreSQL |\n|------|------------|\n| 컬럼 추가 | ALTER TABLE t ADD COLUMN col TYPE; |\n| 컬럼 삭제 | ALTER TABLE t DROP COLUMN col; |\n| 이름 변경 | ALTER TABLE t RENAME COLUMN old TO new; |\n| 타입 변경 | ALTER TABLE t ALTER COLUMN col TYPE newtype; |\n| 기본값 설정 | ALTER TABLE t ALTER COLUMN col SET DEFAULT val; |\n| NOT NULL | ALTER TABLE t ALTER COLUMN col SET NOT NULL; |\n\n### MySQL 차이점\n\`\`\`sql\n-- MySQL은 CHANGE를 사용\nALTER TABLE products\nCHANGE stock_quantity inventory_count INT;\n\`\`\`\n\n### 실무 주의사항\n- 대용량 테이블의 ALTER TABLE은 시간이 오래 걸릴 수 있음\n- NOT NULL 추가 시 기존 NULL 데이터가 있으면 실패\n- 타입 변경 시 데이터 손실 가능성 주의`,
    en: `## ALTER TABLE Advanced\n\n### 1. Add Column\n\`\`\`sql\nALTER TABLE products\nADD COLUMN IF NOT EXISTS discount_rate DECIMAL(5,2) DEFAULT 0.00;\n\`\`\`\n\n### 2. Rename Column\n\`\`\`sql\nALTER TABLE products\nRENAME COLUMN stock_quantity TO inventory_count;\n\`\`\`\n\n### Key ALTER TABLE Operations\n| Operation | PostgreSQL |\n|-----------|------------|\n| Add column | ALTER TABLE t ADD COLUMN col TYPE; |\n| Drop column | ALTER TABLE t DROP COLUMN col; |\n| Rename | ALTER TABLE t RENAME COLUMN old TO new; |\n| Change type | ALTER TABLE t ALTER COLUMN col TYPE newtype; |\n| Set default | ALTER TABLE t ALTER COLUMN col SET DEFAULT val; |\n| NOT NULL | ALTER TABLE t ALTER COLUMN col SET NOT NULL; |\n\n### MySQL Difference\n\`\`\`sql\n-- MySQL uses CHANGE\nALTER TABLE products\nCHANGE stock_quantity inventory_count INT;\n\`\`\`\n\n### Production Notes\n- ALTER TABLE on large tables can be slow\n- Adding NOT NULL fails if existing NULL data exists\n- Type changes may cause data loss`,
  },
  expectedQuery: {
    postgresql: "SELECT column_name, data_type, column_default FROM information_schema.columns WHERE table_name = 'products' AND column_name IN ('discount_rate', 'inventory_count') ORDER BY column_name;",
    mysql: "SELECT column_name, data_type, column_default FROM information_schema.columns WHERE table_name = 'products' AND column_name IN ('discount_rate', 'inventory_count') ORDER BY column_name;",
  },
  gradingMode: 'exact', relatedConcepts: ['ALTER TABLE', 'ADD COLUMN', 'RENAME COLUMN', 'DDL', 'Schema Evolution'],
};
