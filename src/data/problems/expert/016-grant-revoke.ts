import type { Problem } from '@/types/problem';

export const problem: Problem = {
  id: 'expert-016', level: 'expert', order: 16,
  title: { ko: 'GRANT/REVOKE: 권한 관리', en: 'GRANT/REVOKE: Permission Management' },
  description: {
    ko: `데이터베이스 사용자 권한을 관리하세요.\n\n### 요구사항\n1. 읽기 전용 사용자를 생성하세요:\n\`\`\`sql\nDO $$\nBEGIN\n  IF NOT EXISTS (SELECT FROM pg_catalog.pg_roles WHERE rolname = 'readonly_user') THEN\n    CREATE ROLE readonly_user LOGIN PASSWORD 'readonly123';\n  END IF;\nEND\n$$;\n\`\`\`\n\n2. 스키마 사용 권한을 부여하세요:\n\`\`\`sql\nGRANT USAGE ON SCHEMA public TO readonly_user;\n\`\`\`\n\n3. 테이블 읽기 권한을 부여하세요:\n\`\`\`sql\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;\n\`\`\`\n\n4. 부여된 권한을 확인하세요:\n\`\`\`sql\nSELECT grantee, table_name, privilege_type\nFROM information_schema.table_privileges\nWHERE grantee = 'readonly_user'\nORDER BY table_name, privilege_type;\n\`\`\`\n\n> **채점**: 4번 SELECT 쿼리의 결과로 채점됩니다.\n\n### DBA 권한 관리\n- **GRANT**: 권한 부여\n- **REVOKE**: 권한 회수\n- 최소 권한 원칙(Principle of Least Privilege) 적용이 핵심`,
    en: `Manage database user permissions.\n\n### Requirements\n1. Create a read-only user:\n\`\`\`sql\nDO $$\nBEGIN\n  IF NOT EXISTS (SELECT FROM pg_catalog.pg_roles WHERE rolname = 'readonly_user') THEN\n    CREATE ROLE readonly_user LOGIN PASSWORD 'readonly123';\n  END IF;\nEND\n$$;\n\`\`\`\n\n2. Grant schema usage:\n\`\`\`sql\nGRANT USAGE ON SCHEMA public TO readonly_user;\n\`\`\`\n\n3. Grant table read access:\n\`\`\`sql\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;\n\`\`\`\n\n4. Verify granted permissions:\n\`\`\`sql\nSELECT grantee, table_name, privilege_type\nFROM information_schema.table_privileges\nWHERE grantee = 'readonly_user'\nORDER BY table_name, privilege_type;\n\`\`\`\n\n> **Grading**: Based on step 4's SELECT result.\n\n### DBA Permission Management\n- **GRANT**: Give permissions\n- **REVOKE**: Remove permissions\n- Apply Principle of Least Privilege`,
  },
  schema: 'ecommerce', category: 'DCL', difficulty: 3,
  hints: {
    ko: ['CREATE ROLE로 사용자(역할)를 생성합니다.', 'GRANT SELECT ON ALL TABLES IN SCHEMA public로 전체 읽기 권한을 부여합니다.', "SELECT grantee, table_name, privilege_type FROM information_schema.table_privileges WHERE grantee = 'readonly_user' ORDER BY table_name, privilege_type;"],
    en: ['Use CREATE ROLE to create a user (role).', 'GRANT SELECT ON ALL TABLES IN SCHEMA public gives read access to all tables.', "SELECT grantee, table_name, privilege_type FROM information_schema.table_privileges WHERE grantee = 'readonly_user' ORDER BY table_name, privilege_type;"],
  },
  explanation: {
    ko: `## GRANT / REVOKE (권한 관리)\n\n### 사용자(역할) 생성\n\`\`\`sql\nCREATE ROLE readonly_user LOGIN PASSWORD 'readonly123';\n\`\`\`\n\n### 권한 부여 (GRANT)\n\`\`\`sql\n-- 스키마 사용 권한\nGRANT USAGE ON SCHEMA public TO readonly_user;\n\n-- 특정 테이블 읽기 권한\nGRANT SELECT ON products TO readonly_user;\n\n-- 스키마 내 모든 테이블 읽기 권한\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;\n\n-- 전체 권한\nGRANT ALL PRIVILEGES ON TABLE products TO admin_user;\n\`\`\`\n\n### 권한 회수 (REVOKE)\n\`\`\`sql\nREVOKE SELECT ON products FROM readonly_user;\nREVOKE ALL PRIVILEGES ON ALL TABLES IN SCHEMA public FROM readonly_user;\n\`\`\`\n\n### 주요 권한 종류\n| 권한 | 설명 |\n|------|------|\n| SELECT | 조회 |\n| INSERT | 삽입 |\n| UPDATE | 수정 |\n| DELETE | 삭제 |\n| CREATE | 생성 |\n| ALL PRIVILEGES | 모든 권한 |\n\n### 역할 기반 접근 제어 (RBAC)\n\`\`\`sql\n-- 역할 생성\nCREATE ROLE analytics_team;\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO analytics_team;\n\n-- 역할을 사용자에게 부여\nGRANT analytics_team TO user1;\nGRANT analytics_team TO user2;\n\`\`\`\n\n### DBA 핵심 원칙\n- **최소 권한 원칙**: 필요한 권한만 부여\n- **역할 기반 관리**: 개별 사용자 대신 역할로 관리\n- **정기 감사**: 불필요한 권한 정기적 검토/회수`,
    en: `## GRANT / REVOKE (Permission Management)\n\n### Create User (Role)\n\`\`\`sql\nCREATE ROLE readonly_user LOGIN PASSWORD 'readonly123';\n\`\`\`\n\n### Grant Permissions\n\`\`\`sql\n-- Schema usage\nGRANT USAGE ON SCHEMA public TO readonly_user;\n\n-- Specific table read access\nGRANT SELECT ON products TO readonly_user;\n\n-- All tables read access in schema\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;\n\n-- Full access\nGRANT ALL PRIVILEGES ON TABLE products TO admin_user;\n\`\`\`\n\n### Revoke Permissions\n\`\`\`sql\nREVOKE SELECT ON products FROM readonly_user;\nREVOKE ALL PRIVILEGES ON ALL TABLES IN SCHEMA public FROM readonly_user;\n\`\`\`\n\n### Permission Types\n| Permission | Description |\n|-----------|-------------|\n| SELECT | Read |\n| INSERT | Insert |\n| UPDATE | Modify |\n| DELETE | Delete |\n| CREATE | Create |\n| ALL PRIVILEGES | All permissions |\n\n### Role-Based Access Control (RBAC)\n\`\`\`sql\n-- Create role\nCREATE ROLE analytics_team;\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO analytics_team;\n\n-- Assign role to users\nGRANT analytics_team TO user1;\nGRANT analytics_team TO user2;\n\`\`\`\n\n### DBA Principles\n- **Least Privilege**: Grant only necessary permissions\n- **Role-based management**: Manage by roles, not individual users\n- **Regular audits**: Periodically review and revoke unnecessary permissions`,
  },
  expectedQuery: {
    postgresql: "SELECT grantee, table_name, privilege_type FROM information_schema.table_privileges WHERE grantee = 'readonly_user' ORDER BY table_name, privilege_type;",
    mysql: "SELECT grantee, table_name, privilege_type FROM information_schema.table_privileges WHERE grantee = 'readonly_user' ORDER BY table_name, privilege_type;",
  },
  gradingMode: 'exact', relatedConcepts: ['GRANT', 'REVOKE', 'CREATE ROLE', 'Permissions', 'RBAC', 'DDL', 'DBA'],
};
